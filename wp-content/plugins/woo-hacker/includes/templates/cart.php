
<form class="cart-form-example" style="display: none">
    <table>
        <tr class="woocommerce-cart-form__cart-item cart_item">

			<td class="product-remove">
				<a href="/cart/?remove_item=e04f727550ad26170337577bb955a20b&amp;_wpnonce=8abbfbe400" class="remove" aria-label="Удалить эту позицию" data-product_id="241530" data-product_sku="">×</a>
			</td>

			<td class="product-thumbnail">
				<a href="/shop/%d1%88%d0%be%d0%ba%d0%be%d0%bb%d0%b0%d0%b4/%d1%88%d0%be%d0%ba%d0%be%d0%bb%d0%b0%d0%b4-%d1%80%d0%b8%d1%82%d0%b5%d1%80-%d1%81%d0%bf%d0%be%d1%80%d1%82/">
				    <img src="/wp-content/plugins/woocommerce/assets/images/placeholder.png" alt="Заполнитель" width="450" class="woocommerce-placeholder wp-post-image" height="">
				</a>
			</td>

			<td class="product-name" data-title="Товар">
				<a href="/shop/%d1%88%d0%be%d0%ba%d0%be%d0%bb%d0%b0%d0%b4/%d1%88%d0%be%d0%ba%d0%be%d0%bb%d0%b0%d0%b4-%d1%80%d0%b8%d1%82%d0%b5%d1%80-%d1%81%d0%bf%d0%be%d1%80%d1%82/">Шоколад "Ритер Спорт"</a>
			</td>

			<td class="product-price" data-title="Цена">
				<span class="woocommerce-Price-amount amount">
				    120
				    <span class="woocommerce-Price-currencySymbol">
				        <span class="rur">
				            р<span>уб.</span>
				        </span>
				    </span>
				</span>
			</td>

			<td class="product-quantity" data-title="Количество">
				<div class="quantity">
				    <i class="dfd-socicon-minus-symbol minus"></i>
		            <label class="screen-reader-text" for="quantity_5c3fc9934915b">Количество</label>
		            <input type="number" id="quantity_5c3fc9934915b" class="input-text qty text" step="1" min="0" max="" name="cart[e04f727550ad26170337577bb955a20b][qty]" value="1" title="Кол-во" size="4" pattern="[0-9]*" inputmode="numeric" aria-labelledby="Количество Шоколад &quot;Ритер Спорт&quot;">
	                <i class="dfd-socicon-plus-black-symbol plus"></i>
	            </div>
			</td>

			<td class="product-subtotal" data-title="Итого">
				<span class="woocommerce-Price-amount amount">
				    120
				    <span class="woocommerce-Price-currencySymbol">
				        <span class="rur">
				            р<span>уб.</span>
				        </span>
				    </span>
				</span>
			</td>
	    </tr>
	</table>
</form>

<form class="woocommerce-cart-form-clone" style="position: relative; zoom: 1;" action="/cart/" method="post">
	<ul class="vc_tta-tabs-list-days" style="text-align: center;">
    <li style="display:inline-block!important;" class="vc_tta-tab vc_tta-tab-id-days" data-vc-tab="" dayid="-1" disabled="disabled">
        <a style="z-index:1;" href="#Mn" catid="undefined" data-vc-tabs="" data-vc-container=".vc_tta">
            <span class="vc_tta-title-text">ПН</span>
        </a>
    </li>
    <li style="display:inline-block!important;" class="vc_tta-tab vc_tta-tab-id-days" data-vc-tab="" dayid="-2">
        <a style="z-index:1;" href="#Tu" catid="undefined" data-vc-tabs="" data-vc-container=".vc_tta">
            <span class="vc_tta-title-text">ВТ</span>
        </a>
    </li>
    <li style="display:inline-block!important;" class="vc_tta-tab vc_tta-tab-id-days" data-vc-tab="" dayid="-3">
        <a style="z-index:1;" href="#Wn" catid="undefined" data-vc-tabs="" data-vc-container=".vc_tta">
            <span class="vc_tta-title-text">СР</span>
        </a>
    </li>
    <li style="display:inline-block!important;" class="vc_tta-tab vc_tta-tab-id-days" data-vc-tab="" dayid="-4">
        <a style="z-index:1;" href="#Th" catid="undefined" data-vc-tabs="" data-vc-container=".vc_tta">
            <span class="vc_tta-title-text">ЧТ</span>
        </a>
    </li>
    <li style="display:inline-block!important;" class="vc_tta-tab vc_tta-tab-id-days" data-vc-tab="" dayid="-5">
        <a style="z-index:1;" href="#Fr" catid="undefined" data-vc-tabs="" data-vc-container=".vc_tta">
            <span class="vc_tta-title-text">ПТ</span>
        </a>
    </li>
</ul>

<div style="clear:both; z-index:99!important; background-color:transparent!important; margin-top:2px!important; margin-bottom:12px!important;" class="page-nav text-center">
    <div class="dfd-pagination dfd-pagination-style-1">
        <div class="dfd-prev-page hide"><span prvblock="prv"><a>Пред.</a></span><i class="dfd-socicon-arrow-left-01"></i>
        </div>
        <nav class="navigation pagination" role="navigation">
            <h2 class="screen-reader-text">Навигация по записям</h2>
            <div class="nav-links">
                <ul class="page-numbers">
                    <li arfid="1" class="hide"><a pgid="1" class="not-current"  catid="0">1</a><span class="page-numbers current">1</span></li>
                    <li arfid="2" class="hide"><a pgid="2"  catid="0">2</a><span class="page-numbers not-current">2</span></li>
                    <li arfid="3"  class="hide"><a pgid="3"  catid="0">3</a><span class="page-numbers not-current">3</span></li>
                    <li arfid="4"  class="hide"><a pgid="4"  catid="0">4</a><span class="page-numbers not-current">4</span></li>
                    <li arfid="5"  class="hide"><a pgid="5"  catid="0">5</a><span class="page-numbers not-current">5</span></li>
                    <li arfid="6"  class="hide"><a pgid="6"  catid="0">6</a><span class="page-numbers not-current">6</span></li>
                    <li arfid="7"  class="hide"><a pgid="7"  catid="0">7</a><span class="page-numbers not-current">7</span></li>
                    <li arfid="8"  class="hide"><a pgid="8"  catid="0">8</a><span class="page-numbers not-current">8</span></li>
                    <li arfid="9"  class="hide"><a pgid="9"  catid="0">9</a><span class="page-numbers not-current">9</span></li>
                    <li arfid="10"  class="hide"><a pgid="10"  catid="0">10</a><span class="page-numbers not-current">10</span></li>
                    <li arfid="11"  class="hide"><a pgid="11"  catid="0">11</a><span class="page-numbers not-current">11</span></li>
                </ul>
            </div>
        </nav>
        <div class="dfd-next-page hide"><span prvblock="nxt"><a pgid="1" catid="0" href="/?pg=2&amp;cat_id=0">След.</a></span><i class="dfd-socicon-arrow-right-01"></i>
        </div>
    </div>
</div>

	<div class="layout" style="position:absolute; display: none; z-index: 100;cursor: progress; opacity: 0.5; background: white; height: 200%; width:100%; top: -20px;">
	    
	</div>
	<table class="shop_table shop_table_responsive cart woocommerce-cart-form__contents" cellspacing="0">
		<thead>
			<tr>
				<th class="product-remove">&nbsp;</th>
				<th class="product-thumbnail">&nbsp;</th>
				<th class="product-name">Товар</th>
				<th class="product-price">Цена</th>
				<th class="product-quantity">Количество</th>
				<th class="product-subtotal">Итого</th>
			</tr>
		</thead>
		<tbody>

		<tr class="form-submit">
			<td colspan="6" class="actions">
				<button type="submit" class="button" name="update_cart" value="Обновить корзину" disabled="">
				    Обновить корзину
				</button>
				<input type="hidden" id="woocommerce-cart-nonce" name="woocommerce-cart-nonce" value="8abbfbe400"><input type="hidden" name="_wp_http_referer" value="/cart/">
			</td>
		</tr>
	</tbody>
</table>
</form>
<script>
    jQuery(function($) {
        
        var pageSize = 5;
        

        function findTrById(id) {
            var form = $(".woocommerce-cart-form");
            var tableShop = form.find("table.shop_table");
            for (var i = 0; i < tableShop.find("tr").length; ++i) {
                var tr = tableShop.find("tr:eq(" + i + ")");
                var productId = tr.find("td.product-remove a").attr('data-product_id');
                if (typeof productId != 'undefined' && parseInt(id) == parseInt(productId)) {
                    return tr;
                }
            }

            return null;
        }
        
        function makeEnableUpdateCart()
        {
            var form = $(".woocommerce-cart-form-clone");
            var updateBtn = form.find("tr.form-submit button");
            updateBtn.css({'cursor' : 'auto', 'pointerEvents' : 'auto'});
            updateBtn.removeAttr('disabled');
        }
        
        function makeDisableUpdateCart()
        {
            var form = $(".woocommerce-cart-form-clone");
            var updateBtn = form.find("tr.form-submit button");
            updateBtn.css({'cursor' : 'not-allowed', 'pointerEvents' : 'none'});
            updateBtn.attr('disabled', 'disabled');
        }
        
        function startLayout()
        {
             $(".woocommerce-cart-form-clone .layout").css('display', 'block');
        }
        
        function hideLayout()
        {
             $(".woocommerce-cart-form-clone .layout").hide();
        }

        $(".woocommerce-cart-form-clone tr.form-submit button").on('click', function(e){
            e.stopPropagation();
            e.preventDefault();
            startLayout();
            $(".woocommerce-cart-form button[type=submit]").removeAttr('disabled');
            $(".woocommerce-cart-form button[type=submit]").click();
            setTimeout(function(){ makeDisableUpdateCart(); hideLayout(); }, 5000);
        });
        
        function appendProduct(form, data)
        {
                var formExample = $("form.cart-form-example");
                var item = formExample.find('table');
                item = item.clone(true);

                var thumbnail = item.find(".product-thumbnail a img");
                thumbnail.attr('src', data.image);
                
                var productRemove = item.find(".product-remove a");
                productRemove.attr('data-product_id', data.id);
                productRemove.on('click', function(e){
                    e.stopPropagation();
                    e.preventDefault();
                    var id = $(this).attr('data-product_id');
                    var tr = findTrById(id);

                    if (tr != null) {
                        tr.find(".product-remove a").click();
                        startLayout();
                        $(this).closest('tr').remove();
                        setTimeout(function() { makeDisableUpdateCart(); hideLayout(); }, 5000);
                    } else {

                    }
                    
                });

                var productName = item.find(".product-name");
                productName.find("a").attr('href', data.link);
                productName.find("a").attr('data-title', data.title);
                productName.find("a").html(data.title);

                var productPrice = item.find(".product-price");
                var amount = productPrice.find("span.amount")
                var symbol = amount.find(".woocommerce-Price-currencySymbol").clone();
                amount.html(data.price);
                symbol.appendTo(amount);

                var productQ = item.find(".product-quantity");
                productQ.find("input[type=number]").val(data.q);
                productQ.find("i.plus").attr('data-id', data.id);
                productQ.find("i.minus").attr('data-id', data.id);
                productQ.find("input[type=number]").attr({'data-id': data.id, 'data-price': data.price});
                
                productQ.find("input[type=number]").on('change', function() {
                    var id = $(this).attr('data-id');
                    var tr = findTrById(id);

                    if (tr != null) {
                        tr.find(".product-quantity input[type=number]").val($(this).val());
                    } else {

                    }

                    makeEnableUpdateCart();
                    
                    var productTotal = $(this).closest("tr").find(".product-subtotal");
                    var amount = productTotal.find("span.amount")
                    var symbol = amount.find(".woocommerce-Price-currencySymbol").clone();
                    amount.html(parseFloat($(this).attr('data-price')) * parseInt($(this).val()));
                    symbol.appendTo(amount);
                    
                    
                });
                
                var number = productQ.find("input[type=number]").val();
                if (number <= 1) {
                    var signMinus = productQ.find("i.minus");
                    signMinus.css({"pointerEvents" : "none", "opacity" : "0.5"});
                }
                
                productQ.find("i.plus").on('click', function(){
                    var number = productQ.find("input[type=number]").val();
                    ++number;
                    productQ.find("input[type=number]").val(number);
                    var signMinus = productQ.find("i.minus");
                    signMinus.css({"pointerEvents" : "auto", "opacity" : "1"});
                     productQ.find("input[type=number]").change();
                });

                productQ.find("i.minus").on('click', function(){
                    var number = productQ.find("input[type=number]").val();
                    --number;
                    if (number <= 0) { number = 1;}
                    productQ.find("input[type=number]").val(number);
                    if (number <= 1) {
                        $(this).css({"pointerEvents" : "none", "opacity" : "0.5"});
                    }
                     productQ.find("input[type=number]").change();
                }); 
                 
                var productTotal = item.find(".product-subtotal");
                var amount = productTotal.find("span.amount")
                var symbol = amount.find(".woocommerce-Price-currencySymbol").clone();
                amount.html(parseFloat(data.price) * parseInt(data.q));
                symbol.appendTo(amount);

                var tbody = form.find('table.shop_table tbody');
                item.find('tr').appendTo(tbody);

            }

        function makeCart(res) {
            var data =JSON.parse(res);

            var form = $(".woocommerce-cart-form-clone");
            var shopTable = form.find('table.shop_table');
            var tbody = shopTable.find('tbody');
            var tableClone = shopTable.clone(true);

            for (var i = 0; i < form.find(".vc_tta-tabs-list-days li").length; ++i) {
                var t = i + 1;
                if (data.emptyDays.split(",").includes(t.toLocaleString())) {
                    form.find(".vc_tta-tabs-list-days li:eq(" + i + ")").addClass('disabled');
                } else {
                    form.find(".vc_tta-tabs-list-days li:eq(" + i + ")").removeClass('disabled');
                }
            }

            tbody.html('');
            //var cartClone = $(".cart-form-example").clone(true);
            tableClone.find("tr.form-submit").appendTo(tbody);

            var i = 0;
            while (true) {
                if (typeof data[i] == 'undefined' || data[i] == null) {
                    break;
                }

                appendProduct(form, data[i]);

                ++i;
            }

            if (parseInt(data.total) == 0) {
                var tableClone = shopTable.clone(true);
                tbody.html('<tr><td colspan=5><div style="text-align: center;font-weight: bold;">Нету блюд для отображения</div></td></tr>');
                tableClone.find("tr.form-submit").appendTo(tbody);
            }

            shopTable.find("tr.form-submit").appendTo(shopTable.find("tbody"));
            
            var pagination = form.find("div.dfd-pagination");

            if (data.allPages > 1) {
               
                pagination.find(".dfd-prev-page, .dfd-next-page").removeClass("hide");
                pagination.find(".dfd-prev-page, .dfd-next-page").addClass("show");

                var lis = pagination.find("ul.page-numbers li");
                for (var i = 0; i < lis.length; ++i) {
                    var li = pagination.find("ul.page-numbers li:eq(" + i + ")");
                    li.removeClass('hide');
                    li.addClass('show');
                    /*<span class="page-numbers current">1</span>*/
                    if (i + 1 == parseInt(data.page)) {
                        li.find("a").addClass('not-current');
                        li.find("span").addClass("current");
                        li.find("span").removeClass("not-current");
                    } else {
                        li.find("a").removeClass('not-current');
                        li.find("span").removeClass("current");
                        li.find("span").addClass("not-current");
                        
                        
                    }
                    
                    if (i + 1  > parseInt(data.allPages)) {
                        li.addClass('hide');
                    } else {
                        li.removeClass('hide');
                    }
                    
                    li.on('click', function(e) {
                        e.stopPropagation();
                        e.preventDefault();
                        
                        if ($(this).find('span').hasClass('current')) {
                            
                            return true;
                        }

                        var li = listDays.find("li.vc_active");

                        if (li.length > 0) {
                            var day = li.attr('dayid');
                        } else {
                            var day = 0;
                        }

                        var params = {"day" : day, "pageSize": pageSize, "page": $(this).attr('arfid') };
                        startLayout();
                        $.ajax({
                            'url': "/apis/get_cart_items.php",
                            'method': "GET",
                            'data': params,
                            'async': false,
                            'success': function(res) { makeCart(res); hideLayout(); }
                        });
                    });
                    
                }
                
            } else {
                
                pagination.css('visibility', 'hidden');
                var lis = pagination.find("ul.page-numbers li");
                for (var i = 0; i < lis.length; ++i) {
                     var li = pagination.find("ul.page-numbers li:eq(" + i + ")");
                     li.removeClass('show');
                     li.addClass('hide');
                }
                pagination.find(".dfd-prev-page, .dfd-next-page").removeClass("show");
                pagination.find(".dfd-prev-page, .dfd-next-page").addClass("hide");
                
            }
            
        }

        $.get("/apis/get_cart_items.php", {"pageSize" : pageSize, "page" : 1}, function(res) { 
            makeCart(res); 
            var form = $(".woocommerce-cart-form-clone");
            var shopTable = form.find('table.shop_table');
            var frm = $(".woocommerce-cart-form-clone");
            frm.attr('style', frm.attr('style') + "; display: block!important; visibility: visible!important;");
            
            var frm = $(".woocommerce-cart-form");
            frm.attr('style', frm.attr('style') + "; display: none!important;");
            
            var signAlreadyClicked = false;

            $(".woocommerce-cart-form-clone ul li").each(function() {

                if (!$(this).hasClass('disabled') && !signAlreadyClicked) {
                    $(this).click();
                    signAlreadyClicked = true;
                }
            });

        });

        var listDays = $(".vc_tta-tabs-list-days");
        var li = listDays.find("li");

        li.on('click', function() {
            listDays.find("li").removeClass('vc_active');
            $(this).addClass('vc_active');
            var params = {"day" : $(this).attr('dayid'), "pageSize" : pageSize, "page": 1};
            startLayout();
            $.ajax({
                'url': "/apis/get_cart_items.php",
                'method': "GET",
                'data': params,
                'async': true,
                'success': function(res) { makeCart(res); hideLayout(); }
            });
        });
        
        $(".woocommerce-cart-form-clone .dfd-next-page").on('click', function(e){
            e.stopPropagation();
            e.preventDefault();
            var activeSpan = $(this).closest(".dfd-pagination").find(" ul.page-numbers li span.current");
            if (activeSpan.length > 0) {
                var number = parseInt(activeSpan.html());
                //++number;
                var li = $(this).closest(".dfd-pagination").find("ul.page-numbers li:eq(" + number+ ")");
                if (li.length > 0 && !li.hasClass('hide')) { li.click(); }
                
            }
        });
        
         $(".woocommerce-cart-form-clone .dfd-prev-page").on('click', function(e){
            e.stopPropagation();
            e.preventDefault();
            var activeSpan = $(this).closest(".dfd-pagination").find(" ul.page-numbers li span.current");
            if (activeSpan.length > 0) {
                var number = parseInt(activeSpan.html());
                number -= 2;
    
                if (number >= 0) {
                    var li = $(this).closest(".dfd-pagination").find("ul.page-numbers li:eq(" + number+ ")");
                    if (li.length > 0 && !li.hasClass('hide')) { li.click(); }
                }
                
            }
        });

        setInterval(function() {
            var frm = $(".woocommerce-cart-form");
            frm.attr('style', frm.attr('style') + "; display: none!important;");
        }, 250);
    });    
</script>